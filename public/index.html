<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BeatsEdge</title>

<style>
body{
margin:0;
background:#0c0f14;
color:#fff;
font-family:Arial,Helvetica,sans-serif;
}

.topbar{
display:flex;
justify-content:space-between;
align-items:center;
padding:18px 30px;
background:#11151c;
border-bottom:1px solid #1f2630;
}

.logo{
font-size:22px;
font-weight:700;
color:#1db954;
}

.section-title{
padding:25px 30px 10px;
font-size:18px;
color:#888;
}

#best3{
display:flex;
gap:20px;
padding:0 30px 30px;
flex-wrap:wrap;
}

.best-card{
background:#141a22;
padding:20px;
border-radius:10px;
flex:1;
min-width:250px;
border:1px solid #1f2630;
}

#players{
padding:20px 30px 60px;
max-width:1200px;
margin:auto;
}

.player-card{
background:#141a22;
border:1px solid #1f2630;
margin-bottom:20px;
border-radius:10px;
overflow:hidden;
}

.player-header{
display:flex;
justify-content:space-between;
align-items:center;
padding:18px;
cursor:pointer;
}

.player-info{
display:flex;
align-items:center;
gap:12px;
}

.avatar{
background:#1f2630;
width:45px;
height:45px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-weight:700;
overflow:hidden;
}

.avatar img{
width:100%;
height:100%;
object-fit:cover;
}

.player-body{
display:none;
padding:20px;
border-top:1px solid #1f2630;
}

.player-body.open{
display:block;
}

.prop-box{
background:#1b222c;
padding:14px;
border-radius:8px;
margin-bottom:10px;
}

.ev-positive{
color:#1db954;
font-weight:700;
}

.ev-negative{
color:#e74c3c;
font-weight:700;
}

.empty{
text-align:center;
padding:60px;
color:#666;
}
</style>
</head>

<body>

<div class="topbar">
<div class="logo">BeatsEdge</div>
<div id="lastUpdated" style="color:#777;font-size:13px;"></div>
</div>

<div class="section-title">ðŸ”¥ Best 3 Plays</div>
<div id="best3"></div>

<div class="section-title">All Edges</div>
<div id="players"></div>

<script>

let globalData = [];
let bestThree = [];

async function loadData(){

  try{

    const res = await fetch(
      "https://beatsedge-api-production-9337.up.railway.app/api/edges/premium"
    );

    const data = await res.json();

    globalData = data.players || [];
    bestThree = data.bestThree || [];

    document.getElementById("lastUpdated").innerText =
      "Updated: " + new Date().toLocaleTimeString();

    renderBest3();
    renderPlayers();

  }catch(e){
    console.error("API error:",e);
  }
}

/* ======================
   BEST 3 RENDER
====================== */

function renderBest3(){

  const container = document.getElementById("best3");

  if(!bestThree.length){
    container.innerHTML = `<div class="empty">No top plays yet</div>`;
    return;
  }

  container.innerHTML = bestThree.map(p=>`

    <div class="best-card">
      <h3>${p.player}</h3>
      <p><strong>${p.direction} ${p.line} ${p.stat}</strong></p>
      <p>Model: ${p.probability}%</p>
      <p>Vegas: ${p.impliedProbability}%</p>
      <p class="${p.expectedValue >= 0 ? 'ev-positive':'ev-negative'}">
        EV: ${p.expectedValue}
      </p>
    </div>

  `).join("");

}

/* ======================
   ALL PLAYERS RENDER
====================== */

function renderPlayers(){

  const container = document.getElementById("players");

  if(!globalData.length){
    container.innerHTML = `
      <div class="empty">
        <h2>No Active Slate</h2>
      </div>
    `;
    return;
  }

  let html = "";

  globalData.forEach((p,i)=>{

    html += `
    <div class="player-card">

      <div class="player-header" onclick="toggle(${i})">

        <div class="player-info">

          <div class="avatar">
            ${p.player.split(" ").map(x=>x[0]).join("")}
          </div>

          <div>
            <strong>${p.player}</strong>
          </div>

        </div>

        <div>
          <span class="${p.expectedValue >= 0 ? 'ev-positive':'ev-negative'}">
            EV ${p.expectedValue}
          </span>
        </div>

      </div>

      <div class="player-body" id="body-${i}">

        <div class="prop-box">
          <div><strong>${p.direction} ${p.line} ${p.stat}</strong></div>
          <div>Model Probability: ${p.probability}%</div>
          <div>Vegas Implied: ${p.impliedProbability}%</div>
          <div class="${p.expectedValue >= 0 ? 'ev-positive':'ev-negative'}">
            Expected Value: ${p.expectedValue}
          </div>
        </div>

      </div>

    </div>
    `;
  });

  container.innerHTML = html;
}

function toggle(i){
  document.getElementById("body-"+i).classList.toggle("open");
}

/* ======================
   AUTO REFRESH (60s)
====================== */

loadData();
setInterval(loadData, 60000);

</script>

</body>
</html>
